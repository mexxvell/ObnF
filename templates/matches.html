<div class="matches-container">
    <h1>üóìÔ∏è –ë–ª–∏–∂–∞–π—à–∏–µ –º–∞—Ç—á–∏</h1>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö -->
    <div id="notification-container" class="notification-container hidden">
        <div class="notification-banner flip-animation">
            <div class="teams">
                <img src="/static/img/dinamo.png" alt="Team1" class="team-logo">
                <div class="score">
                    <span id="notif-score1">0</span>:<span id="notif-score2">0</span>
                </div>
                <img src="/static/img/spartak.png" alt="Team2" class="team-logo">
            </div>
            <div class="event" id="notif-event">–ì–æ–ª!</div>
            <button id="watch-live-btn">–°–º–æ—Ç—Ä–µ—Ç—å ‚ñ∂Ô∏è</button>
        </div>
    </div>
    
    <!-- –°–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤ -->
    {% for round in rounds %}
    <div class="round-card">
        <h2>–¢—É—Ä {{ round.number }}</h2>
        
        {% for match in round.matches %}
        <div class="match-card" data-match-id="{{ match.id }}">
            <div class="match-header">
                <span class="match-time">{{ match.datetime.strftime('%d.%m %H:%M') }}</span>
                {% if match.status == 'live' %}
                <span class="live-badge">üî¥ LIVE</span>
                {% endif %}
            </div>
            
            <div class="teams">
                <div class="team">
                    <img src="/static/img/{{ match.team1|lower }}.png" alt="{{ match.team1 }}" class="team-logo">
                    <span class="team-name">{{ match.team1 }}</span>
                </div>
                
                <div class="score">
                    {{ match.score1 }}:{{ match.score2 }}
                </div>
                
                <div class="team">
                    <img src="/static/img/{{ match.team2|lower }}.png" alt="{{ match.team2 }}" class="team-logo">
                    <span class="team-name">{{ match.team2 }}</span>
                </div>
            </div>
            
            <div class="match-actions">
                <button class="btn-details" data-match-id="{{ match.id }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                {% if match.status == 'live' %}
                <button class="btn-watch" data-stream-url="{{ match.stream_url }}">–°–º–æ—Ç—Ä–µ—Ç—å</button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>


<script>
<script src="/static/js/matches.js"></script>
<script src="/static/js/notifications.js"></script>
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—á—ë—Ç–∞
    function checkScoreUpdates() {
        const matchCards = document.querySelectorAll('.match-card[data-match-id]');
        const matchIds = Array.from(matchCards).map(card => card.dataset.matchId);
        
        if (matchIds.length === 0) return;
        
        fetch('/miniapp/match_scores', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ match_ids: matchIds })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                data.scores.forEach(score => {
                    const card = document.querySelector(`.match-card[data-match-id="${score.id}"]`);
                    if (card) {
                        const scoreElement = card.querySelector('.score');
                        if (scoreElement.textContent !== `${score.score1}:${score.score2}`) {
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
                            scoreElement.textContent = `${score.score1}:${score.score2}`;
                            scoreElement.classList.add('score-update-animation');
                            setTimeout(() => {
                                scoreElement.classList.remove('score-update-animation');
                            }, 1000);
                        }
                    }
                });
            }
        });
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    setInterval(checkScoreUpdates, 10000);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', () => {
        checkNotifications();
        checkScoreUpdates();
    });
</script>