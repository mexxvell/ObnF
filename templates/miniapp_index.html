{% extends "layout_base.html" %}
{% block content %}
<div id="loading-screen" class="loading-screen">
    <div class="loading-logo">
        <img src="{{ url_for('static', filename='images/league-logo.png') }}" alt="Логотип Лиги">
        <div class="loading-text">Загрузка приложения</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loading-progress-bar"></div>
        </div>
    </div>
</div>

<div id="app-container" class="app-container hidden">
    <div class="app-shell">
        <header class="app-header">
    <button id="burger" class="burger">☰</button>
    <h1>Городская Футбольная Лига</h1>
    <div class="league-logo">
        <img src="{{ url_for('static', filename='images/league-logo1.png') }}" alt="Логотип Лиги">
    </div>
</header>

    <nav id="bottom-menu" class="bottom-menu">
        <button data-tab="home" class="tab-btn active">Главная</button>
        <button data-tab="nlo" class="tab-btn">НЛО 8×8</button>
        <button data-tab="pred" class="tab-btn">Прогнозы</button>
        <button data-tab="profile" class="tab-btn">Профиль</button>
        <button data-tab="support" class="tab-btn">Поддержка</button>
    </nav>

    <main id="main-content" class="main-content">
        <iframe id="page-frame" class="page-frame" frameborder="0" style="display: none;"></iframe>
    </main>

    <div id="live-banner" class="live-banner hidden"></div>

    <div id="side-menu" class="side-menu hidden">
        <ul>
            <li><a href="/miniapp/home" target="page-frame">Главная</a></li>
            <li><a href="/miniapp/matches" target="page-frame">Ближайшие матчи</a></li>
            <li><a href="/miniapp/results" target="page-frame">Результаты</a></li>
            <li><a href="/miniapp/profile" target="page-frame">Профиль</a></li>
            <li><a href="/miniapp/shop" target="page-frame">Магазин</a></li>
            <li><a href="/miniapp/cart" target="page-frame">Корзина</a></li>
                       {% if user_id == owner_id %}
            <li><a href="/miniapp/admin">Админ</a></li>
            {% endif %}
            <li><a href="#" id="close-burger">Закрыть</a></li>
        </ul>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Добавим отладочную информацию в консоль браузера
console.log('[TEMPLATE] miniapp_index.html loaded');

// Проверим, загрузился ли Telegram WebApp API
document.addEventListener('DOMContentLoaded', function() {
    console.log('[TEMPLATE] DOMContentLoaded event in template');
    
    // Проверяем наличие Telegram WebApp API
    if (typeof window.Telegram !== 'undefined' && typeof window.Telegram.WebApp !== 'undefined') {
        console.log('[TEMPLATE] Telegram WebApp API is available');
    } else {
        console.warn('[TEMPLATE] Telegram WebApp API is not available');
    }
    
    // Проверяем, загрузился ли основной скрипт
    if (typeof initializeApp === 'function') {
        console.log('[TEMPLATE] initializeApp function is available');
    } else {
        console.warn('[TEMPLATE] initializeApp function is not available');
        // Попробуем вызвать инициализацию вручную, если она не запустилась автоматически
        if (typeof initializeApp !== 'undefined') {
            console.log('[TEMPLATE] Trying to call initializeApp manually');
            try {
                initializeApp();
            } catch (e) {
                console.error('[TEMPLATE] Error calling initializeApp manually:', e);
            }
        }
    }
});
</script>
{% endblock %}